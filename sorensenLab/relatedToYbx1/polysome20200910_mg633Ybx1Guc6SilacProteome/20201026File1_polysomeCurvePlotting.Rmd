---
title: "Polysome curve plotting"
output:
  html_notebook:
      code_folding: none
---

This document details plotting of curves from polysome fractionation. 

## Setting up the environment

These are packages you will need for this notebook. For exact versions used, please refer to the session info at the bottom of this notebook.

```{r, message = FALSE, warning = FALSE}
###########################################################
library('tidyverse')
library('ggplot2')
library('RColorBrewer')
library('zoo')
```

<div style="margin-bottom:50px;"></div>

Set the base folders where we will do the work.

```{r}
###########################################################
baseWorkspace = 'C:/Users/chughes/Documents/bccrc/projectsWorkspace/sorensenLab/relatedToYbx1'
baseRepository = 'C:/Users/chughes/Documents/bccrc/projectsRepository/sorensenLab/relatedToYbx1'
#baseWorkspace = 'C:/Users/chris/OneDrive/Documents/bccrc/projectsWorkspace/sorensenLab/relatedToYbx1'
#baseRepository = 'C:/Users/chris/OneDrive/Documents/bccrc/projectsRepository/sorensenLab/relatedToYbx1'
```

<div style="margin-bottom:50px;"></div>

## Data processing

Read the curve file generated by the fractionator.

```{r, message = FALSE, warning = FALSE}
###########################################################
polyData = read_csv(paste(baseRepository, '/polysome20200910_mg633Ybx1Guc6SilacProteome/ch_20200910_mg633Ybx1Guc6_polysome.csv', sep = ''), skip = 45)
```

<div style="margin-bottom:50px;"></div>

Make a plot of the raw data.

```{r}
###########################################################
ggplot(polyData, aes(`Position(mm)`, Absorbance)) +
  geom_line(size = 0.25) + 
  scale_y_continuous(limits = c(0,10), breaks = seq(0,10,1))
```

<div style="margin-bottom:50px;"></div>

The first thing we want to do is subset the plot to get rid of the large peak at the start of the gradient. It makes it hard to see the actual polysome data. Based on the above plot, if we just cap the y-axis at a value of 2 and cut off the first 5-mm worth of data, it should be good.

```{r}
###########################################################
polyDataSubset = polyData %>%
  filter(`Position(mm)` >= 5 & Absorbance <= 1.5)
##
ggplot(polyDataSubset, aes(`Position(mm)`, Absorbance)) +
  geom_line(size = 0.25) + 
  scale_y_continuous(limits = c(0,1.2), breaks = seq(0,1.2,0.2))
```

<div style="margin-bottom:50px;"></div>

This looks better, but is a bit spikey in the late part of the gradient. If we do some averaging of the data it might help.

```{r}
###########################################################
polyDataRoll = polyDataSubset %>%
  mutate(avgAbsorbance = rollmean(Absorbance, 2, fill = NA)) ##if you want to change the way the curve looks, change the numerical value here to be higher or lower
##
ggplot(polyDataRoll, aes(`Position(mm)`, avgAbsorbance)) +
  geom_line(size = 1, color = brewer.pal(8, 'Spectral')[8]) +
  labs(x = 'Position (mm)', y = 'Absorbance', title = 'Sucrose gradient - GUC6') +
  scale_y_continuous(limits = c(0,1.2), breaks = seq(0,1.2,0.2)) +
  theme_classic()
ggsave(paste(baseRepository, '/polysome20200910_mg633Ybx1Guc6SilacProteome/line_polysomeGradientCurveSmooth.pdf', sep = ''),
       height = 4, width = 4, useDingbats = FALSE)
```

<div style="margin-bottom:50px;"></div>

## Session info

```{r}
###########################################################
sessionInfo()
```

