left_join(quantSet)
saveRDS(exoSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = ''))
exoSet
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample))
exoSet
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
pivot_wider(id_cols = sample, names_from = sample, values_from = ParentPeakArea)
##########################################################################################
psmFiles = list.files(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/', sep = ''),
pattern = '*Default_PSM_Report\\.txt',
full.names = TRUE)
##
psmSet = data.frame()
for (i in 1:length(psmFiles)){
psmInFile = read_tsv(psmFiles[i]) %>%
dplyr::select(`Protein(s)`, Sequence, `Modified Sequence`, `Spectrum File`, `Spectrum Scan Number`) %>%
mutate(sample = sub('.*Valentina_(.*)\\.raw\\.mgf', '\\1', `Spectrum File`)) %>%
mutate(accession = sapply(str_split(`Protein(s)`, ','), '[', 1)) %>%
filter(!grepl('CONT', accession)) %>%
mutate(scan = `Spectrum Scan Number`) %>%
mutate(sequence = Sequence) %>%
mutate(modSequence = `Modified Sequence`) %>%
left_join(proteinAnnotation) %>%
filter(!is.na(gene)) %>%
dplyr::select(sample, scan, accession, gene, detectablePeptides, sequence, modSequence)
psmSet = rbind(psmSet, psmInFile)
}
##########################################################################################
quantFiles = list.files(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/quantFiles/', sep = ''),
pattern = '*Matrix\\.txt',
full.names = TRUE)
##
quantSet = data.frame()
for (i in 1:length(quantFiles)){
quantInFile = read_tsv(quantFiles[i]) %>%
dplyr::select(MS2ScanNumber, ParentPeakArea)
colnames(quantInFile)[1] = 'scan'
quantInFile$sample = sub('.*Valentina_(.*)\\.raw_Matrix\\.txt', '\\1', quantFiles[i])
quantSet = rbind(quantSet, quantInFile)
}
##########################################################################################
exoSet = psmSet %>%
left_join(quantSet)
saveRDS(exoSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = ''))
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
pivot_wider(id_cols = gene, names_from = sample, values_from = ParentPeakArea)
exoSet
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample))
View(exoSet)
exoSet
exoSet[,5:8]
exoSet[,8]
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
pivot_wider(id_cols = gene, names_from = sample, values_from = ParentPeakArea)
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
pivot_wider(id_cols = gene + sequence, names_from = sample, values_from = ParentPeakArea)
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
pivot_wider(id_cols = c('gene','sequence'), names_from = sample, values_from = ParentPeakArea)
exoset
exoSet
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample))
exoSet
pivot_wider(id_cols = c('gene','scan'), names_from = sample, values_from = ParentPeakArea)
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
pivot_wider(id_cols = c('gene','scan'), names_from = sample, values_from = ParentPeakArea)
exoSet
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
pivot_wider(id_cols = c('gene','scan'), names_from = sample, values_from = ParentPeakArea)
exoSet
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
pivot_wider(id_cols = c('gene','modSequence'), names_from = sample, values_from = ParentPeakArea)
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample))
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
group_by(sample, accession, gene, sequence, modSequence) %>%
summarise(median(ParentPeakArea, na.rm = TRUE))
exoSet
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
group_by(sample, accession, gene, sequence, modSequence) %>%
summarise('parentPeakArea' = median(ParentPeakArea, na.rm = TRUE))
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
group_by(sample, accession, gene, sequence, modSequence) %>%
summarise('parentPeakArea' = median(ParentPeakArea, na.rm = TRUE)) %>%
pivot_wider(id_cols = c('accession','gene','sequence','modSequence'), names_from = sample, values_from = ParentPeakArea)
##########################################################################################
exoSet = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = '')) %>%
filter(grepl('A4573', sample)) %>%
group_by(sample, accession, gene, sequence, modSequence) %>%
summarise('parentPeakArea' = median(ParentPeakArea, na.rm = TRUE)) %>%
pivot_wider(id_cols = c('accession','gene','sequence','modSequence'), names_from = sample, values_from = parentPeakArea)
exoSet
names(exoSet)
##########################################################################################
exoSetSub = subset(exoSet, rowSums(is.na(exoSet[,5:7])) < 2 | rowSums(is.na(exoSet[,8:10])) < 2)
View(exoSetSub)
exoSetSub
names(exoSetSub)
##########################################################################################
quantInput = exoSetSub
saveRDS(quantInput, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesA4573PreDEqMS.rds', sep = ''))
quantInputLog = quantInput[,c(4,2,8:10,5:7)]
quantInputLog[,3:8][quantInputLog[,3:8] == 0] = NA
quantInputLog[,3:8] = log2(quantInputLog[,3:8])
quantInputNormalized = medianSweeping(quantInputLog, group_col = 2)
boxplot(quantInputNormalized, las = 2, ylab = 'log2 ratio', main = 'normalized exosome data')
##########################################################################################
cond = as.factor(c('untreated','untreated','untreated','arsenite','arsenite','arsenite'))
design = model.matrix(~0+cond)
colnames(design) = gsub('cond', '', colnames(design))
##########################################################################################
geneMatrix = as.matrix(quantInputNormalized)
limmaFit1 = lmFit(geneMatrix, design)
limmaContrasts = c('untreated','arsenite')
limmaContrastDesign =  makeContrasts(contrasts = limmaContrasts, levels = design)
limmaFit2 = eBayes(contrasts.fit(limmaFit1, contrasts = limmaContrastDesign))
##########################################################################################
psmCountTable = as.data.frame(table(quantInput$gene))
rownames(psmCountTable) = psmCountTable$Var1
limmaFit2$count = psmCountTable[rownames(limmaFit2$coefficients),2]
limmaFit3 = spectraCounteBayes(limmaFit2)
head(limmaFit3$coefficients)
##
deqmsResults = outputResult(limmaFit3, coef_col = 1)
write.table(deqmsResults,
paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_deqmsA4573UntreatedVsArsenite.csv', sep = ''),
sep = ',', row.names = FALSE, quote = FALSE)
##########################################################################################
exoSet = psmSet %>%
left_join(quantSet)
saveRDS(exoSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = ''))
names(exoSet)
##########################################################################################
exoSet$psm = 1
exoProteinSet = exoSet %>%
group_by(accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE))
exoSet
##########################################################################################
exoSet$psm = 1
exoProteinSet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE))
exoProteinSet
exoProteinSet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE)) %>%
mutate(iBAQ = area / numDetectable)
exoProteinSet
##########################################################################################
exoSet$psm = 1
exoProteinSet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE)) %>%
mutate(iBAQ = area / numDetectable) %>%
filter(psm < (numDetectable * 0.2))
exoProteinSet
##########################################################################################
exoSet$psm = 1
exoProteinSet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE)) %>%
mutate(iBAQ = area / numDetectable) %>%
filter(psm > (numDetectable * 0.2))
exoProteinSet
exoProteinSet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE)) %>%
mutate(iBAQ = area / numDetectable) %>%
filter(psm > (numDetectable * 0.2)) %>%
pivot_wider(id_cols = c('accession','gene'), names_from = sample, values_from = iBAQ)
exoProteinSet
View(exoProteinSet)
exoProteinSet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE)) %>%
mutate(iBAQ = area / numDetectable) %>%
filter(psm > (numDetectable * 0.2)) %>%
pivot_wider(id_cols = c('accession','gene'), names_from = sample, values_from = iBAQ, names_prefix = 'ibaq')
##########################################################################################
exoSet$psm = 1
exoProteinSet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE)) %>%
mutate(iBAQ = area / numDetectable) %>%
filter(psm > (numDetectable * 0.2)) %>%
pivot_wider(id_cols = c('accession','gene'), names_from = sample, values_from = iBAQ, names_prefix = 'ibaq_')
##########################################################################################
exoSet$psm = 1
exoIntensitySet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE)) %>%
mutate(iBAQ = area / numDetectable) %>%
filter(psm > (numDetectable * 0.2)) %>%
pivot_wider(id_cols = c('accession','gene'), names_from = sample, values_from = iBAQ, names_prefix = 'ibaq_')
##
exoPsmSet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE)) %>%
mutate(iBAQ = area / numDetectable) %>%
filter(psm > (numDetectable * 0.2)) %>%
pivot_wider(id_cols = c('accession','gene'), names_from = sample, values_from = psm, names_prefix = 'psm_')
##
exoProteinSet = exoPsmSet %>%
left_join(exoIntensitySet)
names(exoProteinSet)
##########################################################################################
exoProteinSubet = subset(exoProteinSet,
rowSums(is.na(exoProteinSet[,15:17])) < 1 |
rowSums(is.na(exoProteinSet[,18:20])) < 1 |
rowSums(is.na(exoProteinSet[,21:23])) < 1 |
rowSums(is.na(exoProteinSet[,24:26])) < 1)
exoProteinSubset
View(exoProteinSubet)
##########################################################################################
exoProteinSubet = subset(exoProteinSet,
rowSums(is.na(exoProteinSet[,15:17])) < 2 |
rowSums(is.na(exoProteinSet[,18:20])) < 2 |
rowSums(is.na(exoProteinSet[,21:23])) < 2 |
rowSums(is.na(exoProteinSet[,24:26])) < 2)
##########################################################################################
exoProteinSubset = subset(exoProteinSet,
rowSums(is.na(exoProteinSet[,15:17])) < 2 |
rowSums(is.na(exoProteinSet[,18:20])) < 2 |
rowSums(is.na(exoProteinSet[,21:23])) < 2 |
rowSums(is.na(exoProteinSet[,24:26])) < 2)
View(exoProteinSubset)
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = ''))
exocarta
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens')
exocarta
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, database = 'exocarta') %>%
dplyr::select(gene, database)
##
vesicle = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/VESICLEPEDIA_PROTEIN_MRNA_DETAILS_4.1.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, database = 'vesiclepedia') %>%
dplyr::select(gene, database)
exocarta
vesicle
##
vesicle = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/VESICLEPEDIA_PROTEIN_MRNA_DETAILS_4.1.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens')
vesicle
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, database = 'exocarta') %>%
dplyr::select(gene, database) %>%
filter(unique(gene))
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, database = 'exocarta') %>%
dplyr::select(gene, database) %>%
filter(is.unique(gene))
exocarta = unique(exocarta)
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, database = 'exocarta') %>%
dplyr::select(gene, database)
exocarta = unique(exocarta)
##
vesicle = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/VESICLEPEDIA_PROTEIN_MRNA_DETAILS_4.1.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, database = 'vesiclepedia') %>%
dplyr::select(gene, database) %>%
filter(unique(gene))
exocarta
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, database = 'exocarta') %>%
dplyr::select(gene, database)
exocarta = unique(exocarta)
##
vesicle = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/VESICLEPEDIA_PROTEIN_MRNA_DETAILS_4.1.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, database = 'vesiclepedia') %>%
dplyr::select(gene, database) %>%
filter(unique(gene))
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, database = 'exocarta') %>%
dplyr::select(gene, database)
exocarta = unique(exocarta)
##
vesicle = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/VESICLEPEDIA_PROTEIN_MRNA_DETAILS_4.1.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, database = 'vesiclepedia') %>%
dplyr::select(gene, database)
vesicle = unique(vesicle)
vesicle
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, inExocarta = 'yes') %>%
dplyr::select(gene, inExocarta)
exocarta = unique(exocarta)
##
vesicle = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/VESICLEPEDIA_PROTEIN_MRNA_DETAILS_4.1.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, inVesiclepedia = 'yes') %>%
dplyr::select(gene, inVesiclepedia)
vesicle = unique(vesicle)
##########################################################################################
exoAnnotatedSet = exoProteinSubset %>%
left_join(exocarta) %>%
left_join(vesicle)
exoAnnotatedSet
View(exoAnnotatedSet)
##########################################################################################
exoAnnotatedSet = exoProteinSubset %>%
left_join(exocarta) %>%
left_join(vesicle)
saveRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomeProteinsAllSamples.rds', sep = ''))
##########################################################################################
exoAnnotatedSet = exoProteinSubset %>%
left_join(exocarta) %>%
left_join(vesicle)
saveRDS(exoAnnotatedSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomeProteinsAllSamples.rds', sep = ''))
write.table(exoAnnotatedSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomeProteinsAllSamples.csv', sep = ''),
col.names = TRUE, row.names = FALSE, sep = ',', quote = FALSE)
library('tidyverse')
library('ggplot2')
library('RColorBrewer')
library('vroom')
library('DEqMS')
generalDatasets = 'C:/Users/chris/OneDrive/Documents/bccrc/projectsRepository/generalDatasets'
baseWorkspace = 'C:/Users/chris/OneDrive/Documents/bccrc/projectsWorkspace/sorensenLab/relatedToOthers'
baseRepository = 'C:/Users/chris/OneDrive/Documents/bccrc/projectsRepository/sorensenLab/relatedToOthers'
source(paste(baseWorkspace, '/proteomics20200715_exosomeProfilingValentina/userDefinedFunctions.R', sep = ''))
source(paste(baseWorkspace, '/proteomics20200715_exosomeProfilingValentina/userDefinedFunctions.R', sep = ''))
##########################################################################################
proteinAnnotation = readRDS(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/uniprotHumanJul2020.fasta.annotated.rds', sep = ''))
##########################################################################################
psmFiles = list.files(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/', sep = ''),
pattern = '*Default_PSM_Report\\.txt',
full.names = TRUE)
##
psmSet = data.frame()
for (i in 1:length(psmFiles)){
psmInFile = read_tsv(psmFiles[i]) %>%
dplyr::select(`Protein(s)`, Sequence, `Modified Sequence`, `Spectrum File`, `Spectrum Scan Number`) %>%
mutate(sample = sub('.*Valentina_(.*)\\.raw\\.mgf', '\\1', `Spectrum File`)) %>%
mutate(accession = sapply(str_split(`Protein(s)`, ','), '[', 1)) %>%
filter(!grepl('CONT', accession)) %>%
mutate(scan = `Spectrum Scan Number`) %>%
mutate(sequence = Sequence) %>%
mutate(modSequence = `Modified Sequence`) %>%
left_join(proteinAnnotation) %>%
filter(!is.na(gene)) %>%
dplyr::select(sample, scan, accession, gene, detectablePeptides, sequence, modSequence)
psmSet = rbind(psmSet, psmInFile)
}
##########################################################################################
quantFiles = list.files(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/quantFiles/', sep = ''),
pattern = '*Matrix\\.txt',
full.names = TRUE)
##
quantSet = data.frame()
for (i in 1:length(quantFiles)){
quantInFile = read_tsv(quantFiles[i]) %>%
dplyr::select(MS2ScanNumber, ParentPeakArea)
colnames(quantInFile)[1] = 'scan'
quantInFile$sample = sub('.*Valentina_(.*)\\.raw_Matrix\\.txt', '\\1', quantFiles[i])
quantSet = rbind(quantSet, quantInFile)
}
##########################################################################################
exoSet = psmSet %>%
left_join(quantSet)
saveRDS(exoSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomePeptidesAllSamples.rds', sep = ''))
##########################################################################################
exoSet$psm = 1
exoIntensitySet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE)) %>%
mutate(iBAQ = area / numDetectable) %>%
filter(psm > (numDetectable * 0.2)) %>%
pivot_wider(id_cols = c('accession','gene'), names_from = sample, values_from = iBAQ, names_prefix = 'ibaq_')
##
exoPsmSet = exoSet %>%
group_by(sample, accession, gene) %>%
summarise('area' = sum(ParentPeakArea, na.rm = TRUE), 'psm' = sum(psm, na.rm = TRUE), 'numDetectable' = mean(detectablePeptides, na.rm = TRUE)) %>%
mutate(iBAQ = area / numDetectable) %>%
filter(psm > (numDetectable * 0.2)) %>%
pivot_wider(id_cols = c('accession','gene'), names_from = sample, values_from = psm, names_prefix = 'psm_')
##
exoProteinSet = exoPsmSet %>%
left_join(exoIntensitySet)
##########################################################################################
exoProteinSubset = subset(exoProteinSet,
rowSums(is.na(exoProteinSet[,15:17])) < 2 |
rowSums(is.na(exoProteinSet[,18:20])) < 2 |
rowSums(is.na(exoProteinSet[,21:23])) < 2 |
rowSums(is.na(exoProteinSet[,24:26])) < 2)
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, inExocarta = 'yes') %>%
dplyr::select(gene, inExocarta)
exocarta = unique(exocarta)
##
vesicle = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/VESICLEPEDIA_PROTEIN_MRNA_DETAILS_4.1.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, inVesiclepedia = 'yes') %>%
dplyr::select(gene, inVesiclepedia)
vesicle = unique(vesicle)
##########################################################################################
exoAnnotatedSet = exoProteinSubset %>%
left_join(exocarta) %>%
left_join(vesicle)
saveRDS(exoAnnotatedSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomeProteinsAllSamples.rds', sep = ''))
write.table(exoAnnotatedSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomeProteinsAllSamples.csv', sep = ''),
col.names = TRUE, row.names = FALSE, sep = ',', quote = FALSE)
sessionInfo()
library('tidyverse')
library('ggplot2')
library('RColorBrewer')
library('vroom')
library('DEqMS')
psmSet
psmSet[grepl('CD81',psmSet$gene),]
exoSet[grepl('CD81',exoSet$gene),]
exoProteinSet[grepl('CD81',exoProteinSet$gene),]
View(exoProteinSet)
##########################################################################################
exoProteinSubset = subset(exoProteinSet,
rowSums(is.na(exoProteinSet[,15:17])) < 1 |
rowSums(is.na(exoProteinSet[,18:20])) < 1 |
rowSums(is.na(exoProteinSet[,21:23])) < 1 |
rowSums(is.na(exoProteinSet[,24:26])) < 1)
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, inExocarta = 'yes') %>%
dplyr::select(gene, inExocarta)
exocarta = unique(exocarta)
##
vesicle = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/VESICLEPEDIA_PROTEIN_MRNA_DETAILS_4.1.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, inVesiclepedia = 'yes') %>%
dplyr::select(gene, inVesiclepedia)
vesicle = unique(vesicle)
##########################################################################################
exoAnnotatedSet = exoProteinSubset %>%
left_join(exocarta) %>%
left_join(vesicle)
saveRDS(exoAnnotatedSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomeProteinsAllSamplesUnfiltered.rds', sep = ''))
write.table(exoAnnotatedSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomeProteinsAllSamplesUnfiltered.csv', sep = ''),
col.names = TRUE, row.names = FALSE, sep = ',', quote = FALSE)
##########################################################################################
exoProteinSubset = subset(exoProteinSet,
rowSums(is.na(exoProteinSet[,15:17])) < 3 |
rowSums(is.na(exoProteinSet[,18:20])) < 3 |
rowSums(is.na(exoProteinSet[,21:23])) < 3 |
rowSums(is.na(exoProteinSet[,24:26])) < 3)
##########################################################################################
exocarta = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/EXOCARTA_PROTEIN_MRNA_DETAILS_5.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, inExocarta = 'yes') %>%
dplyr::select(gene, inExocarta)
exocarta = unique(exocarta)
##
vesicle = vroom(paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/VESICLEPEDIA_PROTEIN_MRNA_DETAILS_4.1.txt', sep = '')) %>%
filter(SPECIES == 'Homo sapiens') %>%
mutate(gene = `GENE SYMBOL`, inVesiclepedia = 'yes') %>%
dplyr::select(gene, inVesiclepedia)
vesicle = unique(vesicle)
##########################################################################################
exoAnnotatedSet = exoProteinSubset %>%
left_join(exocarta) %>%
left_join(vesicle)
saveRDS(exoAnnotatedSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomeProteinsAllSamplesUnfiltered.rds', sep = ''))
write.table(exoAnnotatedSet, paste(baseRepository, '/proteomics20200715_exosomeProfilingValentina/dataset_exosomeProteinsAllSamplesUnfiltered.csv', sep = ''),
col.names = TRUE, row.names = FALSE, sep = ',', quote = FALSE)
